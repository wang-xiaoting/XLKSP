import router from '@ohos.router';

/**
 * ç§ä¿¡æ¶ˆæ¯æ¥å£
 * å®šä¹‰ç§ä¿¡æ¶ˆæ¯çš„æ•°æ®ç»“æ„
 */
interface Message {
  id: number,           // æ¶ˆæ¯ID
  avatar: Resource,     // å‘é€è€…å¤´åƒ
  name: string,         // å‘é€è€…åç§°
  time: string,         // å‘é€æ—¶é—´
  content: string,      // æ¶ˆæ¯å†…å®¹
  unreadCount?: number  // æœªè¯»æ¶ˆæ¯æ•°ï¼ˆå¯é€‰ï¼‰
}

/**
 * ç³»ç»Ÿé€šçŸ¥æ¥å£
 * å®šä¹‰ç³»ç»Ÿé€šçŸ¥çš„æ•°æ®ç»“æ„
 */
interface Notification {
  id: number,           // é€šçŸ¥ID
  avatar: Resource,     // ç›¸å…³ç”¨æˆ·å¤´åƒ
  name: string,         // ç›¸å…³ç”¨æˆ·åç§°
  time: string,         // é€šçŸ¥æ—¶é—´
  type: string,         // é€šçŸ¥ç±»å‹
  content?: string      // é€šçŸ¥å†…å®¹ï¼ˆå¯é€‰ï¼‰
}

/**
 * å¯¼èˆªé¡¹æ¥å£
 * å®šä¹‰åº•éƒ¨å¯¼èˆªæ é¡¹çš„æ•°æ®ç»“æ„
 */
interface NavItem {
  icon: string,         // å¯¼èˆªå›¾æ ‡
  label: string,        // å¯¼èˆªæ ‡ç­¾
  route: string,        // å¯¼èˆªè·¯ç”±
  active?: boolean      // æ˜¯å¦æ¿€æ´»ï¼ˆå¯é€‰ï¼‰
}

/**
 * æ ‡ç­¾ç±»å‹
 * å®šä¹‰æ¶ˆæ¯é¡µé¢çš„æ ‡ç­¾ç±»å‹
 */
type TabType = 'private' | 'notification' | 'mention' | 'comment';

/**
 * æ¶ˆæ¯é¡µé¢ç»„ä»¶
 * ç”¨äºæ˜¾ç¤ºç”¨æˆ·çš„ç§ä¿¡å’Œç³»ç»Ÿé€šçŸ¥
 */
@Entry
@Component
struct Messages {
  @State currentTab: TabType = 'private'  // å½“å‰é€‰ä¸­çš„æ ‡ç­¾
  @State messages: Message[] = [           // ç§ä¿¡æ¶ˆæ¯åˆ—è¡¨
    {
      id: 1,
      avatar: $r('app.media.profile1'),
      name: 'èˆè¹ˆè¾¾äºº',
      time: '12:30',
      content: 'ä½ å¥½ï¼Œè¯·é—®ä½ å¯¹æœ€æ–°çš„èˆè¹ˆè§†é¢‘æœ‰ä»€ä¹ˆå»ºè®®å—ï¼Ÿæˆ‘è§‰å¾—ä½ çš„åŠ¨ä½œç¼–æ’å¾ˆä¸“ä¸šï¼',
      unreadCount: 2
    },
    {
      id: 2,
      avatar: $r('app.media.profile2'),
      name: 'éŸ³ä¹åˆ¶ä½œäºº',
      time: 'æ˜¨å¤©',
      content: 'æˆ‘åˆšä¸Šä¼ äº†æ–°çš„éŸ³ä¹ï¼Œå¸Œæœ›ä½ èƒ½å¬å¬çœ‹ï¼Œç»™ç‚¹å»ºè®®ï¼'
    }
  ]

  @State notifications: Notification[] = [  // ç³»ç»Ÿé€šçŸ¥åˆ—è¡¨
    {
      id: 1,
      avatar: $r('app.media.profile1'),
      name: 'èˆè¹ˆè¾¾äºº',
      time: '30åˆ†é’Ÿå‰',
      type: 'comment',
      content: 'è¿™ä¸ªåŠ¨ä½œç¼–æ’çœŸä¸é”™ï¼Œæˆ‘å¾ˆå–œæ¬¢ï¼'
    },
    {
      id: 2,
      avatar: $r('app.media.profile2'),
      name: 'éŸ³ä¹åˆ¶ä½œäºº',
      time: '2å°æ—¶å‰',
      type: 'like'
    }
  ]

  // æ ‡ç­¾åç§°æ˜ å°„
  private readonly tabNames: Record<TabType, string> = {
    'private': 'ç§ä¿¡',
    'notification': 'é€šçŸ¥',
    'mention': '@æˆ‘',
    'comment': 'è¯„è®º'
  }

  // é€šçŸ¥ç±»å‹æ–‡æœ¬æ˜ å°„
  private readonly notificationTypes: Record<string, string> = {
    'comment': 'è¯„è®ºäº†ä½ çš„è§†é¢‘',
    'like': 'ç‚¹èµäº†ä½ çš„è§†é¢‘'
  }

  // åº•éƒ¨å¯¼èˆªé¡¹é…ç½®
  private readonly navItems: NavItem[] = [
    { icon: 'ğŸ ', label: 'é¦–é¡µ', route: 'Index', active: false },
    { icon: 'ğŸ”', label: 'å‘ç°', route: 'Discover', active: false },
    { icon: '+', label: 'åˆ›å»º', route: 'Create', active: false },
    { icon: 'ğŸ’¬', label: 'æ¶ˆæ¯', route: 'Messages', active: true },
    { icon: 'ğŸ‘¤', label: 'æˆ‘', route: 'Profile', active: false }
  ]

  /**
   * é¡µé¢å¤´éƒ¨æ„å»ºå™¨
   * åŒ…å«è¿”å›æŒ‰é’®ã€æ ‡é¢˜å’Œæœç´¢æŒ‰é’®
   */
  @Builder Header() {
    Row() {
      Button() {
        Text('â†')
          .fontSize(24)
          .fontColor('#FFFFFF')
      }
      .backgroundColor('transparent')
      .onClick(() => {
        router.back()
      })

      Text('æ¶ˆæ¯')
        .fontSize(18)
        .fontWeight(FontWeight.Bold)
        .fontColor('#FFFFFF')


      Button() {
        Text('âœï¸')
          .fontSize(24)
          .fontColor('#FFFFFF')
          .onClick(() => {
            router.pushUrl({ url: 'pages/setting'})
          })
      }
      .backgroundColor('transparent')
    }
    .width('100%')
    .padding(15)
    .justifyContent(FlexAlign.SpaceBetween)
  }

  /**
   * æ¶ˆæ¯æ ‡ç­¾åˆ‡æ¢æ æ„å»ºå™¨
   * æ„å»ºæ¶ˆæ¯ç±»å‹çš„åˆ‡æ¢æ ‡ç­¾
   */
  @Builder MessageTabs() {
    Row() {
      ForEach(['private', 'notification', 'mention', 'comment'] as TabType[], (tab: TabType) => {
        Text(this.tabNames[tab])
          .fontSize(16)
          .fontColor(this.currentTab === tab ? '#FFFFFF' : 'rgba(255, 255, 255, 0.6)')
          .fontWeight(this.currentTab === tab ? FontWeight.Bold : FontWeight.Normal)
          .padding(10)
          .onClick(() => {
            this.currentTab = tab
          })
      })
    }
    .width('100%')
    .justifyContent(FlexAlign.SpaceAround)
    .borderWidth({ bottom: 1 })
    .borderColor('rgba(255, 255, 255, 0.1)')
  }

  /**
   * æœç´¢æ æ„å»ºå™¨
   * æ„å»ºæ¶ˆæ¯æœç´¢è¾“å…¥æ¡†
   */
  @Builder SearchBar() {
    Row() {
      Text('ğŸ”')
        .fontSize(16)
        .opacity(0.7)
      TextInput({ placeholder: 'æœç´¢è”ç³»äººæˆ–æ¶ˆæ¯' })
        .backgroundColor('transparent')
        .placeholderColor('rgba(255, 255, 255, 0.5)')
        .fontSize(14)
        .width('90%')
        .margin({ left: 10 })
    }
    .width('100%')
    .padding(10)
    .backgroundColor('rgba(255, 255, 255, 0.1)')
    .borderRadius(20)
    .margin(15)
  }

  /**
   * ç§ä¿¡åˆ—è¡¨æ„å»ºå™¨
   * æ„å»ºç§ä¿¡æ¶ˆæ¯åˆ—è¡¨
   */
  @Builder MessageList() {
    List() {
      ForEach(this.messages, (message: Message) => {
        ListItem() {
          Row() {
            Image(message.avatar)
              .width(50)
              .height(50)
              .borderRadius(25)
              .margin({ right: 15 })

            Column() {
              Row() {
                Text(message.name)
                  .fontSize(16)
                  .fontWeight(FontWeight.Bold)
                  .fontColor('#FFFFFF')
                Text(message.time)
                  .fontSize(12)
                  .fontColor('rgba(255, 255, 255, 0.6)')
              }
              .width('100%')
              .justifyContent(FlexAlign.SpaceBetween)

              Text(message.content)
                .fontSize(14)
                .fontColor('rgba(255, 255, 255, 0.8)')
                .maxLines(2)
                .textOverflow({ overflow: TextOverflow.Ellipsis })
            }
            .layoutWeight(1)

            if (message.unreadCount) {
              Text(message.unreadCount.toString())
                .width(18)
                .height(18)
                .fontSize(12)
                .textAlign(TextAlign.Center)
                .borderRadius(9)
                .backgroundColor('#FF0050')
                .fontColor('#FFFFFF')
            }
          }
          .width('100%')
          .padding(15)
        }
        .onClick(() => {
          // å¤„ç†æ¶ˆæ¯ç‚¹å‡»
        })
      })
    }
    .width('100%')
    .layoutWeight(1)
  }

  /**
   * é€šçŸ¥åˆ—è¡¨æ„å»ºå™¨
   * æ„å»ºç³»ç»Ÿé€šçŸ¥åˆ—è¡¨
   */
  @Builder NotificationList() {
    List() {
      ForEach(this.notifications, (notification: Notification) => {
        ListItem() {
          Row() {
            Image(notification.avatar)
              .width(50)
              .height(50)
              .borderRadius(25)
              .margin({ right: 15 })

            Column() {
              Row() {
                Text(notification.name)
                  .fontSize(16)
                  .fontWeight(FontWeight.Bold)
                  .fontColor('#FFFFFF')
                Text(notification.time)
                  .fontSize(12)
                  .fontColor('rgba(255, 255, 255, 0.6)')
              }
              .width('100%')
              .justifyContent(FlexAlign.SpaceBetween)

              Text(this.notificationTypes[notification.type] || '')
                .fontSize(14)
                .fontColor('rgba(255, 255, 255, 0.8)')

              if (notification.content) {
                Text(notification.content)
                  .fontSize(14)
                  .backgroundColor('rgba(255, 255, 255, 0.1)')
                  .padding(10)
                  .borderRadius(8)
                  .margin({ top: 5 })
              }
            }
            .layoutWeight(1)
          }
          .width('100%')
          .padding(15)
        }
      })
    }
    .width('100%')
    .layoutWeight(1)
  }

  /**
   * åº•éƒ¨å¯¼èˆªæ æ„å»ºå™¨
   * æ„å»ºåº”ç”¨åº•éƒ¨å¯¼èˆªèœå•
   */
  @Builder BottomNav() {
    Row() {
      ForEach(this.navItems, (item: NavItem) => {
        Column() {
          Text(item.icon)
            .fontSize(24)
          Text(item.label)
            .fontSize(12)
            .fontColor(item.active ? '#FF0050' : '#FFFFFF')
        }
        .onClick(() => {
          if (!item.active) {
            router.pushUrl({ url: `pages/${item.route}` })
          }
        })
      })
    }
    .width('100%')
    .height(60)
    .padding({ left: 20, right: 20 })
    .justifyContent(FlexAlign.SpaceAround)
    .backgroundColor('rgba(0, 0, 0, 0.8)')
    .borderWidth({ top: 1 })
    .borderColor('rgba(255, 255, 255, 0.1)')
  }

  /**
   * è·å–æ ‡ç­¾æ˜¾ç¤ºåç§°
   * @param tab æ ‡ç­¾ç±»å‹
   * @returns æ ‡ç­¾çš„æ˜¾ç¤ºåç§°
   */
  getTabName(tab: TabType): string {
    return this.tabNames[tab] || ''
  }

  /**
   * è·å–é€šçŸ¥æ˜¾ç¤ºæ–‡æœ¬
   * @param notification é€šçŸ¥å¯¹è±¡
   * @returns é€šçŸ¥çš„æ˜¾ç¤ºæ–‡æœ¬
   */
  getNotificationText(notification: Notification): string {
    return this.notificationTypes[notification.type] || ''
  }

  /**
   * é¡µé¢ä¸»ä½“æ„å»ºå‡½æ•°
   * æ„å»ºæ•´ä¸ªæ¶ˆæ¯é¡µé¢çš„UIç»“æ„
   */
  build() {
    Stack() {
      Column() {
        this.Header()
        this.MessageTabs()
        this.SearchBar()

        if (this.currentTab === 'private') {
          this.MessageList()
        } else if (this.currentTab === 'notification') {
          this.NotificationList()
        } else {
          // ç©ºçŠ¶æ€æ˜¾ç¤º
          Column() {
            Text(this.currentTab === 'mention' ? '@' : 'ğŸ’¬')
              .fontSize(60)
              .margin({ bottom: 20 })
            Text(this.currentTab === 'mention' ? 'æš‚æ— @æåŠ' : 'æš‚æ— è¯„è®º')
              .fontSize(18)
              .fontWeight(FontWeight.Bold)
            Text(this.currentTab === 'mention' ? 'å½“æœ‰äºº@ä½ æ—¶ï¼Œä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ' : 'å½“æœ‰äººè¯„è®ºä½ æ—¶ï¼Œä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ')
              .fontSize(14)
              .opacity(0.7)
          }
          .width('100%')
          .height('60%')
          .justifyContent(FlexAlign.Center)
          .alignItems(HorizontalAlign.Center)
        }

        this.BottomNav()
      }
      .width('100%')
      .height('100%')
      .backgroundColor('#000000')
    }
    .width('100%')
    .height('100%')
  }
}