/*
UserStats - ç”¨æˆ·ç»Ÿè®¡æ•°æ®æ¥å£
Work - ä½œå“ä¿¡æ¯æ¥å£
NavItem - å¯¼èˆªé¡¹æ¥å£
UserInfo - ç”¨æˆ·ä¿¡æ¯æ¥å£
Header() - é¡µé¢å¤´éƒ¨æ„å»ºå™¨
ContentTabs() - å†…å®¹æ ‡ç­¾é¡µæ„å»ºå™¨
ContentGrid() - å†…å®¹ç½‘æ ¼æ„å»ºå™¨
BottomNav() - åº•éƒ¨å¯¼èˆªæ æ„å»ºå™¨
MenuItem() - èœå•é¡¹æ„å»ºå™¨
getTabName() - è·å–æ ‡ç­¾é¡µåç§°
build() - é¡µé¢ä¸»ä½“æ„å»ºå‡½æ•°
*/
import router from '@ohos.router';

interface UserStats {
  following: number, //å…³æ³¨æ•°
  followers: number, //ç²‰ä¸æ•°
  likes: number // ç‚¹èµæ•°
}

interface Work {
  id: number,// ä½œå“ID
  image: string,// ä½œå“å›¾ç‰‡URL
  likes: number // ä½œå“ç‚¹èµæ•°
}

interface NavItem {
  icon: string, // å¯¼èˆªå›¾æ ‡
  label: string,// å¯¼èˆªæ ‡ç­¾
  route: string,// è·¯ç”±è·¯å¾„
  active?: boolean// æ˜¯å¦æ¿€æ´»çŠ¶æ€
}

interface UserInfo {
  avatar: Resource,
  nickname: string,
  bio: string,
  gender: string
}

interface RouteParams {
  userInfo?: UserInfo
}

type TabType = 'collections' | 'works' | 'likes' | 'history';

@Entry
@Component
struct Profile {
  @State username: string = 'èˆè¹ˆå°ç‹å­'
  @State followers: number = 12580
  @State following: number = 256
  @State likes: number = 125800
  @State userInfo: UserInfo = {
    avatar: $r('app.media.profile2'),
    nickname: 'ç”¨æˆ·æ˜µç§°',
    bio: 'è¿™æ˜¯ä¸ªäººç®€ä»‹ï¼Œåˆ†äº«ä½ çš„ç”Ÿæ´»æ€åº¦å’Œä¸ªæ€§',
    gender: 'ä¿å¯†'
  }

  @State currentTab: TabType = 'works'
  @State userStats: UserStats = { // å½“å‰é€‰ä¸­çš„å†…å®¹æ ‡ç­¾
    following: 168,
    followers: 286,
    likes: 42
  }

  @State works: Work[] = [
    {
      id: 1,
      image: 'https://picsum.photos/200/200',
      likes: 42
    },
    {
      id: 2,
      image: 'https://picsum.photos/200/201',
      likes: 18
    }
  ]

  private readonly tabNames: Record<TabType, string> = {
    'collections': 'æ”¶è—',
    'works': 'ä½œå“',
    'likes': 'å–œæ¬¢',
    'history': 'å†å²'
  }

  private readonly navItems: NavItem[] = [
    { icon: 'ğŸ ', label: 'é¦–é¡µ', route: 'Index', active: false },
    { icon: 'ğŸ”', label: 'å‘ç°', route: 'Discover', active: false },
    { icon: '+', label: 'åˆ›å»º', route: 'Create', active: false },
    { icon: 'ğŸ’¬', label: 'æ¶ˆæ¯', route: 'Messages', active: false },
    { icon: 'ğŸ‘¤', label: 'æˆ‘', route: 'Profile', active: true }
  ]

  aboutToAppear() {
    console.info('Profileé¡µé¢å³å°†æ˜¾ç¤º')
    // è·å–è·¯ç”±å‚æ•°
    const params = router.getParams() as RouteParams
    console.info('è·å–åˆ°çš„è·¯ç”±å‚æ•°:', JSON.stringify(params))

    if (params?.userInfo) {
      console.info('æ›´æ–°ç”¨æˆ·ä¿¡æ¯')
      // ç›´æ¥æ›´æ–°æ‰€æœ‰ç›¸å…³çŠ¶æ€
      this.userInfo = params.userInfo
      this.username = params.userInfo.nickname
      // ä¿æŒå…¶ä»–ç»Ÿè®¡æ•°æ®ä¸å˜
      console.info('ç”¨æˆ·ä¿¡æ¯å·²æ›´æ–°:', JSON.stringify(this.userInfo))
    }
  }

  // æ„å»ºé¡¶éƒ¨ç”¨æˆ·ä¿¡æ¯åŒº
  @Builder Header() {
    Column() {
      Button() {
        Text('â†')
          .fontSize(24)
          .fontColor('#FFFFFF')
      }
      .backgroundColor('transparent')
      .position({ x: 20, y: 20 })
      .onClick(() => {
        router.back()
      })

      Image(this.userInfo.avatar) // ç”¨æˆ·å¤´åƒ
        .width(100)
        .height(100)
        .borderRadius(50)
        .border({ width: 2, color: 'rgba(255, 255, 255, 0.2)' }) // åœ†å½¢è¾¹æ¡†
        .margin({ top: 30, bottom: 15 })

      Text(this.userInfo.nickname)
        .fontSize(22)
        .fontWeight(FontWeight.Bold)
        .fontColor('#FFFFFF')
        .margin({ bottom: 8 })

      Text(this.userInfo.bio)
        .fontSize(14)
        .fontColor('rgba(255, 255, 255, 0.8)')
        .margin({ bottom: 15 })
        .textAlign(TextAlign.Center)

      Row() {
        Column() {
          Text(this.userStats.following.toString())
            .fontSize(18)
            .fontWeight(FontWeight.Bold)
            .fontColor('#FFFFFF')
          Text('å…³æ³¨')
            .fontSize(12)
            .fontColor('rgba(255, 255, 255, 0.8)')
        }
        .onClick(() => {
          // å¤„ç†å…³æ³¨ç‚¹å‡»
        })

        Column() {
          Text(this.userStats.followers.toString())
            .fontSize(18)
            .fontWeight(FontWeight.Bold)
            .fontColor('#FFFFFF')
          Text('ç²‰ä¸')
            .fontSize(12)
            .fontColor('rgba(255, 255, 255, 0.8)')
        }
        .margin({ left: 20, right: 20 })
        .onClick(() => {
          // å¤„ç†ç²‰ä¸ç‚¹å‡»
        })

        Column() {
          Text(this.userStats.likes.toString())
            .fontSize(18)
            .fontWeight(FontWeight.Bold)
            .fontColor('#FFFFFF')
          Text('è·èµ')
            .fontSize(12)
            .fontColor('rgba(255, 255, 255, 0.8)')
        }
        .onClick(() => {
          // å¤„ç†è·èµç‚¹å‡»
        })
      }
      .margin({ bottom: 20 })

      Button('ç¼–è¾‘èµ„æ–™')
        .width(120)
        .height(36)
        .fontSize(14)
        .backgroundColor('rgba(255, 255, 255, 0.1)')
        .borderRadius(18)
        .fontColor('#FFFFFF')
        .onClick(() => {
          router.pushUrl({ url: 'pages/ProfileEdit' })
        })
    }
    .width('100%')
    .padding({ top: 20, bottom: 20 })
    .backgroundColor('transparent')
  }

  // æ„å»ºå†…å®¹æ ‡ç­¾åˆ‡æ¢åŒº
  @Builder ContentTabs() {
    Row() {
      ForEach(['collections', 'works', 'likes', 'history'] as TabType[], (tab: TabType) => {
        Text(this.tabNames[tab])
          .fontSize(16)
          .fontColor(this.currentTab === tab ? '#FFFFFF' : 'rgba(255, 255, 255, 0.7)')
          .padding({ top: 15, bottom: 15 })
          .borderWidth({ bottom: this.currentTab === tab ? 2 : 0 })
          .borderColor('#FF0050')
          .onClick(() => {
            this.currentTab = tab
          })
      })
    }
    .width('100%')
    .justifyContent(FlexAlign.SpaceAround)
    .borderWidth({ bottom: 1 })
    .borderColor('rgba(255, 255, 255, 0.1)')
  }

  // æ„å»ºä½œå“ç½‘æ ¼å¸ƒå±€
  @Builder ContentGrid() {
    Grid() {
      ForEach(this.works, (work: Work) => { // ç½‘æ ¼é¡¹
        GridItem() {
          Stack() {
            Image(work.image)
              .width('100%')
              .height('100%')
              .objectFit(ImageFit.Cover)
            Row() {
              Text('â¤ï¸')
                .fontSize(12)
              Text(work.likes.toString())
                .fontSize(12)
                .fontColor('#FFFFFF')
            }
            .position({ x: 5, y: '90%' })
          }
        }
        .aspectRatio(1)
      })
    }
    .columnsTemplate('1fr 1fr 1fr')  // ä¸‰åˆ—å¸ƒå±€
    .columnsGap(2)
    .rowsGap(2)
    .padding(2)
  }

  // æ„å»ºåº•éƒ¨å¯¼èˆªæ 
  @Builder BottomNav() {
    Row() {
      ForEach(this.navItems, (item: NavItem) => {
        Column() {  // å¯¼èˆªé¡¹
          Text(item.icon)  // å¯¼èˆªå›¾æ ‡
            .fontSize(24)
          Text(item.label)
            .fontSize(12)
            .fontColor(item.active ? '#FF0050' : '#FFFFFF')
        }
        .onClick(() => {
          if (!item.active) {
            router.pushUrl({ url: `pages/${item.route}` })
          }
        })
      })
    }
    .width('100%')
    .height(60)
    .padding({ left: 20, right: 20 })
    .justifyContent(FlexAlign.SpaceAround)
    .backgroundColor('rgba(0, 0, 0, 0.8)')
    .borderWidth({ top: 1 })
    .borderColor('rgba(255, 255, 255, 0.1)')
  }

  getTabName(tab: TabType): string {
    return this.tabNames[tab]
  }

  // ä¸»æ„å»ºå‡½æ•°
  build() {
    Stack() {
      Column() {
        this.Header() // é¡¶éƒ¨ç”¨æˆ·ä¿¡æ¯
        this.ContentTabs() // å†…å®¹æ ‡ç­¾
        this.ContentGrid()  // ä½œå“ç½‘æ ¼
        this.BottomNav() // åº•éƒ¨å¯¼èˆª
      }
      .width('100%')
      .height('100%')
      .backgroundColor('#121212')
    }
    .width('100%')
    .height('100%')
  }

  @Builder MenuItem(title: string, icon: string) {
    Row() {
      Text(icon)
        .fontSize(20)
        .margin({ right: 10 })
      Text(title)
        .fontSize(16)
        .fontColor('#FFFFFF')
    }
    .width('100%')
    .height(50)
    .padding({ left: 20, right: 20 })
    .justifyContent(FlexAlign.Start)
    .alignItems(VerticalAlign.Center)
    .backgroundColor('#121212')
    .margin({ bottom: 1 })
  }
}