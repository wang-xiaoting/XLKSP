import router from '@ohos.router';

/**
 * è®¾ç½®é¡¹æ¥å£
 * å®šä¹‰è®¾ç½®é¡µé¢çš„å•ä¸ªè®¾ç½®é¡¹ç»“æ„
 */
interface SettingsItem {
  icon: string,         // è®¾ç½®é¡¹å›¾æ ‡
  label: string,        // è®¾ç½®é¡¹æ ‡ç­¾
  type: 'link' | 'toggle',  // è®¾ç½®é¡¹ç±»å‹ï¼šé“¾æ¥æˆ–å¼€å…³
  route?: string,       // é“¾æ¥ç±»å‹è®¾ç½®é¡¹çš„è·¯ç”±ï¼ˆå¯é€‰ï¼‰
  state?: boolean,      // å¼€å…³ç±»å‹è®¾ç½®é¡¹çš„çŠ¶æ€ï¼ˆå¯é€‰ï¼‰
  onToggle?: () => void // å¼€å…³çŠ¶æ€æ”¹å˜å›è°ƒï¼ˆå¯é€‰ï¼‰
}

/**
 * è®¾ç½®é¡µé¢ç»„ä»¶
 * ç”¨äºç®¡ç†åº”ç”¨çš„å„é¡¹è®¾ç½®
 */
@Entry
@Component
struct Settings {
  @State darkMode: boolean = true    // æ·±è‰²æ¨¡å¼çŠ¶æ€
  @State autoPlay: boolean = true    // è‡ªåŠ¨æ’­æ”¾çŠ¶æ€

  /**
   * é¡µé¢å¤´éƒ¨æ„å»ºå™¨
   * åŒ…å«è¿”å›æŒ‰é’®å’Œæ ‡é¢˜
   */
  @Builder Header() {
    Row() {
      Button() {
        Text('â†')
          .fontSize(24)
          .fontColor('#FFFFFF')
      }
      .backgroundColor('transparent')
      .onClick(() => {
        router.back()
      })

      Text('è®¾ç½®')
        .fontSize(18)
        .fontWeight(FontWeight.Bold)
        .fontColor('#FFFFFF')
    }
    .width('100%')
    .padding(20)
    .justifyContent(FlexAlign.Start)
  }

  /**
   * è®¾ç½®åˆ†ç»„æ„å»ºå™¨
   * æ„å»ºä¸€ä¸ªè®¾ç½®åˆ†ç»„ï¼ŒåŒ…å«æ ‡é¢˜å’Œè®¾ç½®é¡¹åˆ—è¡¨
   * @param title åˆ†ç»„æ ‡é¢˜
   * @param items è®¾ç½®é¡¹åˆ—è¡¨
   */
  @Builder SettingsSection(title: string, items: SettingsItem[]) {
    Column() {
      Text(title)
        .fontSize(14)
        .opacity(0.7)
        .backgroundColor('rgba(0, 0, 0, 0.3)')
        .width('100%')
        .padding(15)

      List() {
        ForEach(items, (item: SettingsItem) => {
          ListItem() {
            Row() {
              Row() {
                Text(item.icon)
                  .fontSize(20)
                  .opacity(0.8)
                  .width(24)
                  .textAlign(TextAlign.Center)
                Text(item.label)
                  .fontSize(16)
                  .fontColor('#FFFFFF')
                  .margin({ left: 10 })
              }

              if (item.type === 'link') {
                Text('â€º')
                  .fontSize(14)
                  .opacity(0.5)
              } else if (item.type === 'toggle') {
                Toggle({ type: ToggleType.Switch, isOn: item.state })
                  .selectedColor('#FF0050')
                  .switchPointColor('#FFFFFF')
                  .onChange(item.onToggle)
              }
            }
            .width('100%')
            .justifyContent(FlexAlign.SpaceBetween)
            .padding(15)
          }
          .onClick(() => {
            if (item.type === 'link' && item.route) {
              router.pushUrl({ url: item.route })
            }
          })
        })
      }
      .divider({
        strokeWidth: 1,
        color: 'rgba(255, 255, 255, 0.1)'
      })
    }
    .margin({ bottom: 20 })
  }

  /**
   * é¡µé¢ä¸»ä½“æ„å»ºå‡½æ•°
   * æ„å»ºæ•´ä¸ªè®¾ç½®é¡µé¢çš„UIç»“æ„
   */
  build() {
    Stack() {
      Column() {
        // èƒŒæ™¯æ¸å˜
        Column()
          .width('100%')
          .height('100%')
          .backgroundImage($r('app.media.background1'))
          .backgroundImageSize(ImageSize.Cover)
          .blur(3)
          .opacity(0.8)

        Column() {
          this.Header()

          Scroll() {
            Column() {
              // è´¦å·è®¾ç½®åˆ†ç»„
              this.SettingsSection('è´¦å·è®¾ç½®', [
                {
                  icon: 'ğŸ‘¤',
                  label: 'ä¸ªäººä¿¡æ¯',
                  type: 'link',
                  route: 'pages/ProfileEdit'
                } as SettingsItem,
                {
                  icon: 'ğŸ”’',
                  label: 'éšç§è®¾ç½®',
                  type: 'link',
                  route: 'pages/Privacy'
                } as SettingsItem,
                {
                  icon: 'ğŸ””',
                  label: 'é€šçŸ¥è®¾ç½®',
                  type: 'link',
                  route: 'pages/Notifications'
                } as SettingsItem
              ])

              // å†…å®¹ä¸éšç§è®¾ç½®åˆ†ç»„
              this.SettingsSection('å†…å®¹ä¸éšç§', [
                {
                  icon: 'ğŸ’¾',
                  label: 'ç¦»çº¿ä¸‹è½½è®¾ç½®',
                  type: 'link',
                  route: 'pages/Download'
                } as SettingsItem,
                {
                  icon: 'ğŸŒ™',
                  label: 'æ·±è‰²æ¨¡å¼',
                  type: 'toggle',
                  state: this.darkMode,
                  onToggle: () => {
                    this.darkMode = !this.darkMode
                  }
                } as SettingsItem,
                {
                  icon: 'ğŸ“±',
                  label: 'è‡ªåŠ¨æ’­æ”¾',
                  type: 'toggle',
                  state: this.autoPlay,
                  onToggle: () => {
                    this.autoPlay = !this.autoPlay
                  }
                } as SettingsItem
              ])

              // å…³äºè®¾ç½®åˆ†ç»„
              this.SettingsSection('å…³äº', [
                {
                  icon: 'â“',
                  label: 'å¸®åŠ©ä¸­å¿ƒ',
                  type: 'link',
                  route: 'pages/Help'
                } as SettingsItem,
                {
                  icon: 'ğŸ“„',
                  label: 'ç”¨æˆ·åè®®',
                  type: 'link',
                  route: 'pages/Agreement'
                } as SettingsItem,
                {
                  icon: 'ğŸ”’',
                  label: 'éšç§æ”¿ç­–',
                  type: 'link',
                  route: 'pages/Privacy'
                } as SettingsItem
              ])

              // é€€å‡ºç™»å½•æŒ‰é’®
              Button('é€€å‡ºç™»å½•')
                .width('90%')
                .height(50)
                .fontSize(16)
                .fontWeight(FontWeight.Bold)
                .backgroundColor('rgba(255, 0, 0, 0.2)')
                .fontColor('#FF5555')
                .margin(20)
                .onClick(() => {
                  // å¤„ç†é€€å‡ºç™»å½•
                })

              // ç‰ˆæœ¬ä¿¡æ¯
              Text('ç‰ˆæœ¬ 1.0.0 (build 100)')
                .fontSize(12)
                .opacity(0.5)
                .textAlign(TextAlign.Center)
                .margin(20)
            }
            .width('100%')
          }
          .scrollBar(BarState.Off)
          .layoutWeight(1)
        }
        .width('100%')
        .height('100%')
      }
      .width('100%')
      .height('100%')
      .backgroundColor('#000000')
    }
    .width('100%')
    .height('100%')
  }
}