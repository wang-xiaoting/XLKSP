/*
éŸ³é¢‘æ’­æ”¾å™¨æ ¸å¿ƒåŠŸèƒ½ï¼šåŒ…å«æ’­æ”¾çŠ¶æ€ç®¡ç†ã€è¿›åº¦æ§åˆ¶ã€æ—¶é—´è®¡ç®—
åŠ¨æ€éŸ³é¢‘å¯è§†åŒ–ï¼šé€šè¿‡å®šæ—¶å™¨ç”Ÿæˆéšæœºé«˜åº¦æŸ±çŠ¶å›¾æ¨¡æ‹ŸéŸ³é¢‘æ³¢å½¢
å®Œæ•´çš„æ’­æ”¾å™¨UIï¼šåŒ…å«ä¸“è¾‘å°é¢æ—‹è½¬åŠ¨ç”»ã€æ¨¡ç³ŠèƒŒæ™¯ã€æ“ä½œæŒ‰é’®ç»„
äº¤äº’åŠŸèƒ½ï¼šæ”¯æŒæ’­æ”¾/æš‚åœã€è¿›åº¦æ‹–åŠ¨ã€ç‚¹èµç­‰æ“ä½œ
ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼šç»„ä»¶é”€æ¯æ—¶è‡ªåŠ¨æ¸…ç†å®šæ—¶å™¨
å“åº”å¼è®¾è®¡ï¼šé€šè¿‡@Stateå®ç°æ•°æ®å˜åŒ–è‡ªåŠ¨è§¦å‘UIæ›´æ–°
å…³é”®API/ç»„ä»¶ï¼š
setIntervalï¼šç”¨äºåˆ›å»ºå®šæ—¶å™¨
Sliderï¼šè¿›åº¦æ¡ç»„ä»¶
@Builderï¼šè‡ªå®šä¹‰æ„å»ºå‡½æ•°
Stack/Column/Rowï¼šå¸ƒå±€å®¹å™¨
Image/Textï¼šåŸºç¡€æ˜¾ç¤ºç»„ä»¶
routerï¼šé¸¿è’™è·¯ç”±æ¨¡å—
*/
import router from '@ohos.router'

@Entry //è‡ªå®šä¹‰å…¥å£ç»„ä»¶
@Component
struct AudioPlayer {
  @State currentProgress: number = 0
  //çŠ¶æ€ç®¡ç†åŒºåŸŸ
  @State isPlaying: boolean = false //å½“å‰è¿›åº¦æ’­æ”¾ç™¾åˆ†æ¯”
  @State currentTime: string = '00:00' //æ’­æ”¾çŠ¶æ€æ§åˆ¶
  @State totalTime: string = '03:45' //æ ¼å¼åŒ–çš„å½“å‰æ’­æ”¾æ—¶é—´
  @State audioBarHeights: number[] = Array(30).fill(20) //éŸ³é¢‘å¯è§†åŒ–æŸ±çŠ¶å›¾çš„30ä¸ªéšæœºé«˜åº¦å€¼
  @State isLiked: boolean = false // ç‚¹èµæŒ‰é’®çŠ¶æ€
  @State likeCount: string = '5.7w' //ç‚¹èµæ•°
  @State commentCount: string = '3208' //è¯„è®ºæ•°é‡

  private intervalID: number = -1//å­˜å‚¨å®šæ—¶å™¨idç”¨äºæ¸…é™¤

  aboutToAppear() {
    // å¯åŠ¨éŸ³é¢‘æ¡åŠ¨ç”»
    this.intervalID = setInterval(() => {
      this.audioBarHeights = this.audioBarHeights.map(() => Math.floor(Math.random() * 40) + 10)
    }, 200)

    // æ¨¡æ‹Ÿè¿›åº¦æ›´æ–°
    setInterval(() => {
      if (this.isPlaying) {
        this.currentProgress = (this.currentProgress + 0.1) % 100
        this.updateCurrentTime() // è°ƒç”¨æ—¶é—´æ ¼å¼åŒ–æ–¹æ³•
      }
    }, 100)
  }

  aboutToDisappear() {
    if (this.intervalID !== -1) {
      clearInterval(this.intervalID)
    }
  }

  // æ ¹æ®è¿›åº¦ç™¾åˆ†æ¯”è®¡ç®—å½“å‰æ’­æ”¾æ—¶é—´
  updateCurrentTime() {
    const totalSeconds = 225 // 3:45 in seconds
    const currentSeconds = Math.floor(totalSeconds * (this.currentProgress / 100))
    const minutes = Math.floor(currentSeconds / 60)
    const seconds = currentSeconds % 60
    this.currentTime = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`
  }// æ ¼å¼åŒ–ä¸ºä¸¤ä½æ•°å­—ï¼ˆå¦‚ 03:15ï¼‰

  // æ„å»ºé¡¶éƒ¨å¯¼èˆªæ ï¼ˆåŒ…å«è¿”å›æŒ‰é’®å’Œæ ‡é¢˜ï¼‰/* ä½¿ç”¨Row/Image/Textç­‰ç»„ä»¶å®ç°å¯¼èˆªæ å¸ƒå±€ */
  @Builder Header() {
    Row() {
      Button() {
        Text('â†')
          .fontSize(24)
          .fontColor('#FFFFFF')
      }
      .backgroundColor('transparent')
      .onClick(() => {
        router.back()
      })

      Text('æ­£åœ¨æ’­æ”¾')
        .fontSize(18)
        .fontWeight(FontWeight.Bold)
        .fontColor('#FFFFFF')
    }
    .width('100%')
    .justifyContent(FlexAlign.SpaceBetween)
    .padding(20)
  }

  // æ„å»ºæ—‹è½¬ä¸“è¾‘å°é¢ï¼ˆæ’­æ”¾æ—¶æ·»åŠ æ—‹è½¬åŠ¨ç”»ï¼‰/* ä½¿ç”¨Imageç»„ä»¶å’ŒåŠ¨ç”»å±æ€§å®ç° */
  @Builder AlbumCover() {
    Stack() {
      Image($r('app.media.album_cover1'))
        .width(250)
        .height(250)
        .borderRadius(10)
        .objectFit(ImageFit.Cover)
        .rotate({
          x: 0,
          y: 0,
          z: 1,
          angle: this.isPlaying ? this.currentProgress * 3.6 : 0,
          centerX: '50%',
          centerY: '50%'
        })
    }
    .margin({ top: 50 })
  }

  // æ„å»ºéŸ³é¢‘å¯è§†åŒ–æ•ˆæœï¼ˆåŠ¨æ€é«˜åº¦çš„æŸ±çŠ¶å›¾ï¼‰// æ ¹æ®audioBarHeightsæ•°ç»„ç”Ÿæˆå¤šä¸ªæŸ±çŠ¶æ¡
  @Builder AudioVisualizer() {
    Row({ space: 3 }) {
      ForEach(this.audioBarHeights, (height: number) => {
        Column()
          .width(4)
          .height(height)
          .backgroundColor('#FFFFFF')
          .borderRadius(2)
          .opacity(this.isPlaying ? 1 : 0.3)
      })
    }
    .width('80%')
    .height(60)
    .justifyContent(FlexAlign.Center)
    .alignItems(VerticalAlign.Bottom)
    .margin({ top: 30 })
  }

  // æ„å»ºå³ä¾§æ“ä½œæŒ‰é’®ç»„ï¼ˆç‚¹èµ/è¯„è®º/åˆ†äº«ç­‰ï¼‰ /* ä½¿ç”¨Columnå¸ƒå±€å‚ç›´æ’åˆ—å›¾æ ‡æŒ‰é’® */
  @Builder SideActions() {
    Column({ space: 20 }) {
      Column({ space: 5 }) {
        Button() {
          Text(this.isLiked ? 'â¤ï¸' : 'ğŸ¤')
            .fontSize(24)
        }
        .width(50)
        .height(50)
        .borderRadius(25)
        .backgroundColor('rgba(255, 255, 255, 0.2)')
        .onClick(() => {
          this.isLiked = !this.isLiked
          this.likeCount = this.isLiked ? '5.8w' : '5.7w'
        })
        Text(this.likeCount)
          .fontSize(12)
          .fontColor('#FFFFFF')
      }

      Column({ space: 5 }) {
        Button() {
          Text('ğŸ’¬')
            .fontSize(24)
        }
        .width(50)
        .height(50)
        .borderRadius(25)
        .backgroundColor('rgba(255, 255, 255, 0.2)')
        Text(this.commentCount)
          .fontSize(12)
          .fontColor('#FFFFFF')
      }

      Column({ space: 5 }) {
        Button() {
          Text('â¤´ï¸')
            .fontSize(24)
        }
        .width(50)
        .height(50)
        .borderRadius(25)
        .backgroundColor('rgba(255, 255, 255, 0.2)')
        Text('åˆ†äº«')
          .fontSize(12)
          .fontColor('#FFFFFF')
      }

      Column({ space: 5 }) {
        Button() {
          Text('â™«')
            .fontSize(24)
        }
        .width(50)
        .height(50)
        .borderRadius(25)
        .backgroundColor('rgba(255, 255, 255, 0.2)')
        Text('æ”¶è—')
          .fontSize(12)
          .fontColor('#FFFFFF')
      }
    }
    .position({ x: '85%', y: '40%' })
  }

  // ä¸»æ„å»ºå‡½æ•°ï¼šå®šä¹‰æ•´ä½“UIç»“æ„
  build() {
    Stack() {
      // èƒŒæ™¯æ¸å˜
      Column()
        .width('100%')
        .height('100%')
        .backgroundImage($r('app.media.background1'))
        .backgroundImageSize(ImageSize.Cover)
        .blur(3) //æ·»åŠ æ¨¡ç³Šæ•ˆæœ
        .opacity(0.8)

      Column() {
        // é¡¶éƒ¨å¯¼èˆª
        this.Header()

        // ä¸“è¾‘å°é¢
        this.AlbumCover()

        // éŸ³é¢‘å¯è§†åŒ–
        this.AudioVisualizer()

        // ä¾§è¾¹æ“ä½œæŒ‰é’®
        this.SideActions()

        // éŸ³ä¹æ§åˆ¶
        // æ’­æ”¾æ§åˆ¶æŒ‰é’®è¡Œï¼ˆä¸Šä¸€æ›²/æ’­æ”¾æš‚åœ/ä¸‹ä¸€æ›²ï¼‰
        Row({ space: 20 }) {
          Button() {
            Text('â®ï¸')
              .fontSize(24)
          }
          .width(50)
          .height(50)
          .borderRadius(25)
          .backgroundColor('rgba(255, 255, 255, 0.2)')

          Button() {
            Text(this.isPlaying ? 'â¸ï¸' : 'â–¶ï¸')
              .fontSize(24)
          }
          .width(60)
          .height(60)
          .borderRadius(30)
          .backgroundColor('rgba(255, 255, 255, 0.3)')
          .onClick(() => {
            this.isPlaying = !this.isPlaying
          })

          Button() {
            Text('â­ï¸')
              .fontSize(24)
          }
          .width(50)
          .height(50)
          .borderRadius(25)
          .backgroundColor('rgba(255, 255, 255, 0.2)')
        }
        .margin({ top: 50 })

        // éŸ³ä¹ä¿¡æ¯
        Column({ space: 5 }) {
          Text('æ™šé£è½»æŠš')
            .fontSize(18)
            .fontWeight(FontWeight.Bold)
            .fontColor('#FFFFFF')
          Text('è½»éŸ³ä¹å¤§å¸ˆ - å¿ƒçµæ²»æ„ˆç³»åˆ—')
            .fontSize(14)
            .fontColor('#FFFFFF')
            .opacity(0.8)
        }
        .margin({ top: 20 })

        // è¿›åº¦æ¡
        Slider({
          value: this.currentProgress,
          min: 0,
          max: 100,
          style: SliderStyle.OutSet
        })
          .width('80%')
          .margin({ top: 20 })
          .selectedColor('#FFFFFF')
          .trackColor('rgba(255, 255, 255, 0.3)')
          .onChange((value: number) => {  //æ»‘åŠ¨æ›´æ–°è¿›åº¦
            this.currentProgress = value
            this.updateCurrentTime()
          })

        // æ—¶é—´ä¿¡æ¯
        Row() {
          Text(this.currentTime) // å½“å‰æ—¶é—´
            .fontSize(12)
            .fontColor('#FFFFFF')
            .opacity(0.8)
          Text(this.totalTime) //æ€»æ—¶é•¿
            .fontSize(12)
            .fontColor('#FFFFFF')
            .opacity(0.8)
        }
        .width('80%')
        .justifyContent(FlexAlign.SpaceBetween)
        .margin({ top: 10 })
      }
      .width('100%')
      .height('100%')
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#000000') //æ•´ä½“èƒŒæ™¯é»‘è‰²
  }
}